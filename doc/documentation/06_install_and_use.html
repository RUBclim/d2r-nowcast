

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. Install and Use &mdash; D2R Nowcasting Development v0.8.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=b5df399c"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1. Input Data" href="02_data_sources.html" />
    <link rel="prev" title="1. Overview" href="01_overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/d2r_logo_II.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_overview.html">1. Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="01_overview.html#introduction">1.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_overview.html#what-is-the-problem-d2r-solves">1.2. What is the problem D2R solves?</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Install and Use</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setup">2.1. Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#structure">2.2. Structure</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="02_data_sources.html">1. Input Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="02_data_sources.html#data-describing-the-urban-form">1.1. Data Describing the Urban Form</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_data_sources.html#data-describing-the-weather-conditions">1.2. Data Describing the Weather Conditions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="02_data_sources.html#numerical-weather-predictions">1.2.1. Numerical Weather Predictions</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_data_sources.html#in-situ-measurements">1.2.2. In-Situ Measurements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="02_data_sources.html#file-organization">1.3. File organization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="03_methods.html">2. Methods and Processes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="03_methods.html#processes">2.1. Processes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="03_methods.html#preprocessing">2.1.1. Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_methods.html#alignment-of-weather-data">2.1.2. Alignment of Weather Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_methods.html#geostatistical-interpolation-module">2.1.3. Geostatistical Interpolation Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="03_methods.html#design-of-the-interpolation-module">2.1.3.1. Design of the Interpolation Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="03_methods.html#workflow-description">2.1.3.2. Workflow Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="03_methods.html#solweig-processing">2.1.4. SOLWEIG Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_methods.html#mosaicing-tiles">2.1.5. Mosaicing Tiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_methods.html#calculating-thermal-comfort">2.1.6. Calculating Thermal Comfort</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="03_methods.html#api">2.2. API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="04_output_format.html">3. Output Format</a><ul>
<li class="toctree-l2"><a class="reference internal" href="04_output_format.html#filenames">3.1. Filenames</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_output_format.html#spatial-coverage">3.2. Spatial Coverage</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_output_format.html#spatial-resolution">3.3. Spatial Resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_output_format.html#temporal-resolution-and-coverage">3.4. Temporal Resolution and Coverage</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Background</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="05_scientific_background.html">1. Scientific Background</a><ul>
<li class="toctree-l2"><a class="reference internal" href="05_scientific_background.html#thermal-comfort">1.1. Thermal Comfort</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_scientific_background.html#utci">1.2. UTCI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="07_limitations.html">2. Limitations</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">D2R Nowcasting</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">2. </span>Install and Use</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/documentation/06_install_and_use.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="install-and-use">
<span id="id1"></span><h1><span class="section-number">2. </span>Install and Use<a class="headerlink" href="#install-and-use" title="Link to this heading"></a></h1>
<section id="setup">
<span id="id2"></span><h2><span class="section-number">2.1. </span>Setup<a class="headerlink" href="#setup" title="Link to this heading"></a></h2>
<p>The backend is developed in Python 3.12</p>
<p>For running the pipeline (see <code class="docutils literal notranslate"><span class="pre">src/process_next_timestep.sh</span></code>) as the backend service the following steps need to be taken:</p>
<ol class="arabic simple">
<li><p>Setup the structure</p>
<ol class="loweralpha simple">
<li><p>The project runs in Python 3.12, which can be seen in the base image used in the Dockerfile for the backend, <code class="docutils literal notranslate"><span class="pre">backend.Dockerfile</span></code>.</p></li>
<li><p>We import modules from a separate project called <code class="docutils literal notranslate"><span class="pre">UMEP-processing-fork</span></code>.
It keeps the standalone files of the required UMEP tool along with the original code of the toolbox. (See also <a class="reference internal" href="03_methods.html#methods-and-processes"><span class="std std-numref">Section 2</span></a> in the
documentation for a more detailed description of the methods and processes.)</p></li>
<li><p>For frequently downloading NWP GRIB2 data from the DWD file server, the DWD <code class="docutils literal notranslate"><span class="pre">downloader</span></code> has to be installed (current version 0.2.0).
This happens within <code class="docutils literal notranslate"><span class="pre">backend.Dockerfile</span></code> but requires a clone of that project next to <code class="docutils literal notranslate"><span class="pre">d2r-nowcast</span></code> (see folder structure below).</p></li>
<li><p>For downloading relevant ICON-D2 data and cropping it to the city extent, we use the functions placed in <code class="docutils literal notranslate"><span class="pre">src/icon_d2</span></code>.</p></li>
</ol>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>DWD announced a change in accessing DWD open data <a class="reference external" href="https://www.dwd.de/DE/leistungen/opendata/neuigkeiten/opendata_april2025_1.html" rel="noreferrer" target="_blank">Release Notes</a>
in April 2025, which also affects the <code class="docutils literal notranslate"><span class="pre">downloader</span></code> tool and expected data format used in this project.
At some point the <code class="docutils literal notranslate"><span class="pre">downloader</span></code> will not be functional anymore due to changes in the data format and this step will have to be adjusted.
The tool’s repository was already converted to a public archive on github and no further changes or updates are expected.</p>
</div>
<ol class="arabic" start="2">
<li><p>The project structure now has to look like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Common Parent Folder
├── d2r-nowcast
├── downloader
└── UMEP-processing-fork
</pre></div>
</div>
</li>
<li><p>Build the Docker image</p>
<p>Build the repository into a Docker image using the following command from the parent folder of <code class="docutils literal notranslate"><span class="pre">d2r-nowcast</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span> <span class="pre">-f</span> <span class="pre">d2r-nowcast/src/backend.Dockerfile</span> <span class="pre">-t</span> <span class="pre">d2r-backend:&lt;version&gt;</span> <span class="pre">.</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The flag <code class="docutils literal notranslate"><span class="pre">-f</span></code> allows to define a specific Dockerfile to be used.
The container tag indicated with the <code class="docutils literal notranslate"><span class="pre">-t</span></code> flag can be set individually but needs to be consistent throughout the references in later steps.</p>
</div>
</li>
<li><p>Setup a script to run the Docker container</p>
<p>Create a script to run the Docker container at an arbitrary path <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;/&lt;to&gt;/cronscript_&lt;version&gt;.sh</span></code>. To do this, copy and adjust the
Docker run and Docker log commands in <code class="docutils literal notranslate"><span class="pre">src/cronscript_template.sh</span></code> to your needs. Adjust the paths to the datasets on your machine, set up available memory and CPU, etc.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The SOLWEIG processes are run in multiprocessing mode, and the number of processes should match the defined available CPUs. Within the code,
the number of processes is fixed to 32 in <code class="docutils literal notranslate"><span class="pre">umep_wrapper/solweig_multi_processing.py</span></code> with this line:</p>
<p><code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">Pool(processes=32,</span> <span class="pre">initializer=worker_init,</span> <span class="pre">initargs=[q])</span> <span class="pre">as</span> <span class="pre">pool</span></code></p>
<p>The number of available CPUs is set with the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command in the above-mentioned script, using the <code class="docutils literal notranslate"><span class="pre">--cpus</span></code> flag. For our current
setup, the following configuration is useful: <code class="docutils literal notranslate"><span class="pre">--memory=128gb</span> <span class="pre">--cpus=32</span></code>, but this can be adjusted according to your requirements and limitations.</p>
</div>
</li>
<li><p>Edit the crontab</p>
<p>Edit the crontab for your user on your machine using <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-e</span></code> and set up an hourly cron job by adding the following line:</p>
<p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">&lt;path&gt;/&lt;to&gt;/cronscript_&lt;version&gt;.sh</span> <span class="pre">1&gt;</span> <span class="pre">/dev/null</span> <span class="pre">2&gt;</span> <span class="pre">&lt;path&gt;/&lt;to&gt;/&lt;error_file&gt;.err</span></code></p>
<p>This command executes the prepared script from the previous step every hour, redirecting standard output (<code class="docutils literal notranslate"><span class="pre">1&gt;</span></code>) to <code class="docutils literal notranslate"><span class="pre">/dev/null</span></code> and standard
errors (<code class="docutils literal notranslate"><span class="pre">2&gt;</span></code>) to <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;/&lt;to&gt;/&lt;error_file&gt;.err</span></code>.</p>
<p>There is a <code class="docutils literal notranslate"><span class="pre">src/cronscript_template.sh</span></code> as guide for the specific docker run command executed on cron call.</p>
</li>
</ol>
</section>
<section id="structure">
<span id="id3"></span><h2><span class="section-number">2.2. </span>Structure<a class="headerlink" href="#structure" title="Link to this heading"></a></h2>
<p>The project is structured as follows:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">src/umep_wrapper</span></code>:</dt><dd><p>Contains scripts that can be run separately on the server to generate new data and corresponding Dockerfiles.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">src/umep_wrapper/config-templates</span></code>:</dt><dd><p>Contains config templates to run algorithms of the UMEP toolbox: Wall, SVF, SOLWEIG.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">src/icon_d2</span></code>:</dt><dd><p>Contains scripts to download and pre-process ICON-D2 NWP data from the DWD for our purposes.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">src/interpolate</span></code>:</dt><dd><p>Contains scripts to interpolate data from the measurement network for our purposes.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">src/utils</span></code>:</dt><dd><p>Contains utility scripts.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tests</span></code>:</dt><dd><p>Contains some tests for ensuring the functionality of the pipeline. Tests can be executed via <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-s</span> <span class="pre">-v</span></code> in a properly set up virtual environment.</p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01_overview.html" class="btn btn-neutral float-left" title="1. Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="02_data_sources.html" class="btn btn-neutral float-right" title="1. Input Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright MIT License - Copyright (c) 2023-2024 Data2Resilience Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>